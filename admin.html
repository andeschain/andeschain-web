<!DOCTYPE html>
<html lang="es">
<head>
    <title>Admin | AndesChain</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script> tailwind.config = { theme: { extend: { colors: { 'corp': { 500: '#10B981', 600: '#059669', 900: '#022C22' } }, fontFamily: { sans: ['Inter'], display: ['Outfit'] } } } } </script>
</head>
<body class="bg-slate-900 text-white font-sans p-6">
    <header class="flex justify-between items-center mb-10">
        <div class="flex items-center gap-3">
            <img src="assets/favicon.png" class="h-8 brightness-200 grayscale">
            <div><h1 class="font-display font-bold text-xl uppercase">AndesChain Node</h1><p class="text-[10px] text-emerald-500 font-mono">VALIDATOR ACTIVE</p></div>
        </div>
    </header>

    <main class="max-w-4xl mx-auto">
        <h2 class="font-display text-2xl font-bold mb-6">Mempool (Pendientes)</h2>
        <div class="bg-black/30 border border-white/10 rounded-3xl overflow-hidden backdrop-blur">
            <table class="w-full text-left">
                <thead class="bg-white/5 text-[10px] font-bold uppercase text-gray-500">
                    <tr><th class="p-6">Fecha</th><th class="p-6">Productor</th><th class="p-6">Evidencia</th><th class="p-6 text-right">AcciÃ³n</th></tr>
                </thead>
                <tbody id="table-body" class="text-sm">
                    </tbody>
            </table>
            <div id="empty" class="hidden p-10 text-center text-gray-600">Sin pendientes</div>
        </div>
    </main>

    <script src="js/simulador.js"></script>
    <script>
        const db = getProductos();
        const tbody = document.getElementById('table-body');
        let hasPending = false;

        db.forEach((item, index) => {
            if (item.estado === 'PENDING') {
                hasPending = true;
                const tr = document.createElement('tr');
                tr.className = "border-b border-white/5 hover:bg-white/5";
                tr.innerHTML = `
                    <td class="p-6 opacity-60">${item.fecha}</td>
                    <td class="p-6 font-bold">${item.productor}<br><span class="text-xs font-normal opacity-50">${item.lote}</span></td>
                    <td class="p-6 font-mono text-xs text-emerald-400"><i class="fas fa-map-marker-alt"></i> ${item.lat}, ${item.lon}</td>
                    <td class="p-6 text-right">
                        <button onclick="certificar(${index})" class="bg-white text-black px-4 py-2 rounded-lg text-xs font-bold uppercase hover:bg-emerald-400 transition">AcuÃ±ar</button>
                    </td>
                `;
                tbody.appendChild(tr);
            }
        });

        if(!hasPending) document.getElementById('empty').classList.remove('hidden');

        function certificar(index) {
            let _db = getProductos();
            _db[index].estado = 'VERIFIED';
            _db[index].historia = "Certificado digitalmente en la red AndesChain."; // Historia default
            localStorage.setItem('andesDB', JSON.stringify(_db));
            alert("ðŸ”— Bloque acuÃ±ado en Polygon.");
            window.location.reload();
        }
    </script>
</body>
</html>
